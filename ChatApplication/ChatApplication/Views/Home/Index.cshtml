@{
    ViewBag.Title = "Home Page";
   
}

<link href="~/Content/chat.css" rel="stylesheet" />


    <ol class="chat">
        
        </ol>
   
        <input class="messageType" id="message" type="text" placeholder="Type here!" />
     
        <input type="hidden" id="displayname" />
  
        <input type="hidden" id="avatar" />

    
@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
<script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $(function () {
           
           var avatarObj = [
           "http://i.imgur.com/DY6gND0.png",
           "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQfiXLWilNkWB9ZJqHPYd61qr9Qnl4NNjONQax5UGosmV1jmSe0Xw"
         
           ];

            // Reference the auto-generated proxy for the hub.
            var chat = $.connection.chatHub;
            // Create a function that the hub can call back to display messages.
            chat.client.addNewMessageToPage = function (name, message) {
                // Add the message to the page.
             
                var now = new Date();
                var outStr = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds();

                var displaySide = "other";
                var userImage = avatarObj[1];
                if ($('#displayname').val() == name) {
                    displaySide = "self";
                    userImage = avatarObj[0];
                }


             


                $('.chat').append('<li class="' + displaySide + '">' +
                  '<div class="avatar"><img src="' + userImage + '" draggable="false" /></div>' +
                 '<div class="msg">'+
                   '<p class="username">'+ htmlEncode(name) +'</p>'+
                    '<p>' + htmlEncode(message) + '</p>'+
                ' <time>' + outStr + '</time>' +
              '</div>'+
               '</li>');

                $('body,html').animate({
                    scrollTop: $('body').get(0).scrollHeight
                }, 0);
              
                
            };
         
            
          
            // Create a function that the hub can call to recalculate online users.
            chat.client.recalculateOnlineUsers = function (message) {
                                // Add the message to the page. 
                $('#users').text(message);
                $("#avatar").replaceWith('  <input type="hidden" value="'+message+'" id="avatarset" />')
            };
            // Get the user name and store it to prepend to messages.
            $('#displayname').val(prompt('Enter your name:', ''));
            $("#nameofuser").replaceWith("<label>"+$('#displayname').val()+"</label>");
            // Set initial focus to message input box.
            $('#message').focus();
            // Start the connection.
            $.connection.hub.start().done(function () {
                $('.messageType').keypress(function (event) {
                    var keycode = (event.keyCode ? event.keyCode : event.which);
                    if (keycode == '13') {
                        // Call the Send method on the hub.
                        chat.server.send($('#displayname').val(), $('#message').val());
                        // Clear text box and reset focus for next comment.
                        $('#message').val('').focus();
                    }
                });
            
            });
        });
        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
    </script>
}